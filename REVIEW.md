# گزارش بررسی فنی پروژه (Technical Review Report)

این گزارش شامل بررسی کدهای پروژه، شناسایی باگ‌ها، مشکلات منطقی، امنیتی و پیشنهادهای بهینه‌سازی است.

## ۱. باگ‌ها (Bugs)
*   **مشکل راه‌اندازی اولیه (Init Race Condition):** در فایل `js/services/auth.js`، تابع `init` وضعیت احراز هویت را بررسی می‌کند اما تضمینی برای بروزرسانی UI در بارگذاری اولیه ندارد. اگر پاسخ `getSession` کندتر از رندر صفحه باشد یا `onAuthStateChange` فایر نشود، صفحه سفید (Blank Screen) نمایش داده می‌شود.
    *   *راه حل:* فراخوانی صریح `updateUI()` پس از دریافت پاسخ اولیه `getSession`.
*   **مشکل مسیردهی (Import Paths):** در برخی فایل‌ها (مانند `VisitList.js` و `OrdersView.js`) مسیر ایمپورت `db.js` به اشتباه `../../db.js` درج شده بود که باید به `../../services/db.js` اصلاح شود.

## ۲. خطاهای منطقی (Logical Errors)
*   **فیلتر روی داده‌های ناقص (Client-side Filtering on Partial Data):**
    *   *توضیح:* سیستم از Pagination (صفحه‌بندی) سمت سرور برای دریافت داده‌ها (`loadChunk`) استفاده می‌کند، اما فیلترها (منطقه، وضعیت ویزیت و...) به صورت **Local** روی داده‌های لود شده اعمال می‌شوند.
    *   *پیامد:* اگر کاربری فیلتر "منطقه ۱" را انتخاب کند، فقط فروشگاه‌های منطقه ۱ که در "صفحه اول" هستند نمایش داده می‌شوند و فروشگاه‌های منطقه ۱ در صفحات بعدی دیده نمی‌شوند.
    *   *راه حل:* فیلترها باید به کوئری دیتابیس (`db.getStores`) منتقل شوند.
*   **بازسازی کامل لیست (Inefficient Re-rendering):**
    *   *توضیح:* دکمه "نمایش بیشتر" داده‌های جدید را دریافت می‌کند، اما تابع `render` کل لیست (قدیمی + جدید) را دوباره از صفر می‌سازد (`innerHTML = ''`).
    *   *پیامد:* کندی شدید با افزایش تعداد آیتم‌ها.

## ۳. مشکلات امنیتی (Security Issues)
*   **نشت کلید Supabase:** کلید `SUPABASE_ANON_KEY` در کد کلاینت (`config.js`) قرار دارد. این در برنامه‌های کلاینت‌-محور (SPA) اجتناب‌ناپذیر است، اما **حیاتی** است که در سمت Supabase، قوانین امنیتی (RLS - Row Level Security) به درستی تنظیم شده باشند تا کاربران فقط به داده‌های خود دسترسی داشته باشند.
*   **تزریق کد (XSS Risk):** استفاده از `innerHTML` برای نمایش داده‌های کاربر (نام فروشگاه، توضیحات) خطرناک است. هرچند از تابع `escapeHtml` استفاده شده، اما روش ایمن‌تر استفاده از `textContent` برای متون است.

## ۴. بهینه‌سازی (Optimizations)
*   **تعداد درخواست‌های HTTP:** برنامه از ماژول‌های جداگانه (ES Modules) بدون باندلر (Bundler) استفاده می‌کند. این باعث می‌شود مرورگر ده‌ها درخواست جداگانه برای فایل‌های JS ارسال کند که سرعت لود اولیه را کاهش می‌دهد.
    *   *پیشنهاد:* استفاده از ابزاری مثل Vite برای باندل کردن فایل‌ها.
*   **کش‌گذاری:** سرویس ورکر (`sw.js`) استراتژی کش مناسبی دارد، اما باید اطمینان حاصل شود که با تغییر ورژن فایل‌ها، نام کش (`CACHE_NAME`) حتماً آپدیت شود، در غیر این صورت کاربران کدهای قدیمی را می‌بینند.

---
*تهیه شده توسط: ژول (Jules)*
